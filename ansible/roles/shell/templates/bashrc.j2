# ==================
# Bash Configuration (.bashrc)
# ==================

# ------------------
# Source Common Shell Configuration
# ------------------
[ -f ~/.shell_common.sh ] && source ~/.shell_common.sh


# ------------------
# Bash History Settings
# ------------------
export HISTFILE="$HOME/.bash_history"
export HISTSIZE=10000
export HISTFILESIZE=10000
export HISTCONTROL=ignoredups:ignorespace
export HISTTIMEFORMAT="[%F %T] "
shopt -s histappend


# ------------------
# Shell Behavior
# ------------------
shopt -s autocd                  # like Zsh AUTO_CD
shopt -s cdable_vars
shopt -s dirspell                # fix small typos in cd
shopt -s checkwinsize
shopt -s globstar                # ** recursive globbing like Zsh
shopt -s extglob                 # extended globs


# ------------------
# Bash Completion System
# ------------------
# Bash has no zstyle. Uses programmable completion instead.
if [ -f /opt/homebrew/etc/bash_completion ]; then
    source /opt/homebrew/etc/bash_completion
elif [ -f /usr/local/etc/bash_completion ]; then
    source /usr/local/etc/bash_completion
fi


# ------------------
# Keybindings (Bash equivalent)
# ------------------
bind 'set show-all-if-ambiguous on'
bind 'set completion-ignore-case on'
bind '"\C-r": reverse-search-history'
bind '"\C-s": forward-search-history'

# Open command line in $EDITOR
edit-current-line() {
    local tmp=$(mktemp)
    printf "%s" "$READLINE_LINE" > "$tmp"
    "$EDITOR" "$tmp"
    READLINE_LINE=$(cat "$tmp")
    READLINE_POINT=${#READLINE_LINE}
    rm -f "$tmp"
}
bind -x '"\C-x\C-e":edit-current-line'


# ------------------
# Bash-specific Listing Functions
# ------------------
# Note: Bash doesn't have zsh glob qualifiers, so we use simpler versions
# For full functionality, use the eza-based sll/sld/slf aliases

# ll: long list with all files
ll() {
    ls -lhAF "$@"
}

# lld: list only directories
lld() {
    local target="${1:-.}"
    ls -lhFd "$target"/*/ 2>/dev/null
}

# llf: list only files (basic version for bash)
llf() {
    local target="${1:-.}"
    # Use find to get only files, then ls -ld on each
    find "$target" -maxdepth 1 -type f -exec ls -lhF {} + 2>/dev/null
}

# lldot: list only dotfiles
lldot() {
    local target="${1:-.}"
    ls -lhFd "$target"/.* 2>/dev/null | tail -n +3
}


# ------------------
# Bash-specific Aliases
# ------------------
alias which='type -p'
alias path='echo -e "${PATH//:/\n}"'
alias reload='source ~/.bashrc && echo "Bashrc reloaded"'


# ------------------
# FZF Bash Integration
# ------------------
if command -v fzf >/dev/null 2>&1; then
    [ -f ~/.fzf.bash ] && source ~/.fzf.bash
fi


# ------------------
# Local Overrides
# ------------------
[ -f ~/.bashrc.local ] && source ~/.bashrc.local


# ------------------
# Starship Prompt (bash-specific init)
# ------------------
if command -v starship >/dev/null 2>&1; then
    eval "$(starship init bash)"
fi


# ------------------
# Zoxide (must be at the end)
# ------------------
if command -v zoxide >/dev/null 2>&1; then
    eval "$(zoxide init bash)"
fi
