---
# ==================
# Neovim Minimal Configuration Role
# ==================

# Installation handled by homebrew role via Brewfile

- name: Remove existing Neovim configuration (if clean install requested)
  file:
    path: "{{ ansible_facts['env']['HOME'] }}/.config/nvim"
    state: absent
  when: nvim_clean_install | default(false)
  tags: neovim

- name: Create Neovim config directory
  file:
    path: "{{ ansible_facts['env']['HOME'] }}/.config/nvim"
    state: directory
    mode: '0755'
  tags: neovim

- name: Deploy init.lua configuration
  copy:
    src: init.lua
    dest: "{{ ansible_facts['env']['HOME'] }}/.config/nvim/init.lua"
    mode: '0644'
  tags: neovim

- name: Create Neovim data directory (for undo history, etc)
  file:
    path: "{{ ansible_facts['env']['HOME'] }}/.local/share/nvim"
    state: directory
    mode: '0755'
  tags: neovim

- name: Display Neovim setup message
  debug:
    msg: |
      Neovim has been configured. On first run, Lazy.nvim will automatically
      bootstrap and install all plugins. This takes 30-60 seconds.
      
      Run 'nvim' to complete the setup.
      
      Useful commands after installation:
        :Lazy - Plugin manager UI
        :Mason - LSP/formatter installer UI
        :checkhealth - Check Neovim health
        :LspInfo - Check LSP status for current buffer
  tags: neovim
