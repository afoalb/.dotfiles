---
# ==============================================================================
# Neovim with LazyVim Configuration Role
# ==============================================================================
# Sets up Neovim with LazyVim distribution
# Installation handled by homebrew role via Brewfile
# ==============================================================================

- name: Remove existing Neovim configuration (for clean LazyVim install)
  file:
    path: "{{ ansible_env.HOME }}/.config/nvim"
    state: absent
  when: lazyvim_clean_install | default(false)
  tags: neovim

- name: Create Neovim config directory
  file:
    path: "{{ ansible_env.HOME }}/.config/nvim"
    state: directory
    mode: '0755'
  tags: neovim

- name: Clone LazyVim starter template
  git:
    repo: 'https://github.com/LazyVim/starter'
    dest: "{{ ansible_env.HOME }}/.config/nvim"
    version: main
    update: no
  tags: neovim

- name: Remove LazyVim starter .git directory (to make it your own)
  file:
    path: "{{ ansible_env.HOME }}/.config/nvim/.git"
    state: absent
  tags: neovim

- name: Create LazyVim lua/plugins directory for custom plugins
  file:
    path: "{{ ansible_env.HOME }}/.config/nvim/lua/plugins"
    state: directory
    mode: '0755'
  tags: neovim

- name: Deploy custom LazyVim configuration
  copy:
    src: "{{ item }}"
    dest: "{{ ansible_env.HOME }}/.config/nvim/lua/{{ item }}"
    mode: '0644'
  loop:
    - config/options.lua
    - config/keymaps.lua
  ignore_errors: yes
  tags: neovim

- name: Deploy custom plugin configurations
  copy:
    src: plugins/
    dest: "{{ ansible_env.HOME }}/.config/nvim/lua/plugins/"
    mode: '0644'
  ignore_errors: yes
  tags: neovim

- name: Create Neovim data directory
  file:
    path: "{{ ansible_env.HOME }}/.local/share/nvim"
    state: directory
    mode: '0755'
  tags: neovim

- name: Display LazyVim setup message
  debug:
    msg: |
      LazyVim has been installed. On first run, Neovim will automatically
      install plugins. Run 'nvim' to complete the setup.

      Useful LazyVim commands:
        :Lazy - Plugin manager
        :Mason - LSP/formatter/linter installer
        :LazyHealth - Check health
        <leader> (space) - Opens which-key menu
  tags: neovim
