---
# ==============================================================================
# Yabai & Skhd Configuration Role
# ==============================================================================
# Configures yabai tiling window manager and skhd hotkey daemon
# Installation handled by homebrew role via Brewfile
# ==============================================================================

- name: Deploy yabairc configuration
  copy:
    src: yabairc
    dest: "{{ ansible_facts['env']['HOME'] }}/.yabairc"
    mode: '0755'
  tags: yabai

- name: Deploy skhdrc configuration
  copy:
    src: skhdrc
    dest: "{{ ansible_facts['env']['HOME'] }}/.skhdrc"
    mode: '0644'
  tags: yabai

- name: Check if yabai is running
  shell: launchctl list | grep yabai || true
  register: yabai_status
  changed_when: false
  tags: yabai

- name: Check if skhd is running
  shell: launchctl list | grep skhd || true
  register: skhd_status
  changed_when: false
  tags: yabai

- name: Start yabai service
  command: yabai --start-service
  when: yabai_status.stdout == ""
  tags: yabai

- name: Restart yabai service if already running
  command: yabai --restart-service
  when: yabai_status.stdout != ""
  tags: yabai

- name: Start skhd service
  command: skhd --start-service
  when: skhd_status.stdout == ""
  tags: yabai

- name: Restart skhd service if already running
  command: skhd --restart-service
  when: skhd_status.stdout != ""
  tags: yabai
