---
##########################
# Finder Defaults
##########################
- name: Show hidden files
  shell: defaults write com.apple.finder AppleShowAllFiles -bool true
  #become_user: "{{ ansible_user }}"

- name: Show all file extensions
  shell: defaults write NSGlobalDomain AppleShowAllExtensions -bool true
  #become_user: "{{ ansible_user }}"

- name: Prevent creation of .DS_Store on network drives
  shell: defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool true
  #become_user: "{{ ansible_user }}"

- name: Show full POSIX path in Finder window titles
  shell: defaults write com.apple.finder _FXShowPosixPathInTitle -bool true
  #become_user: "{{ ansible_user }}"

- name: Set Finder default location to Home folder
  shell: |
    defaults write com.apple.finder NewWindowTarget -string "PfHm"
    defaults write com.apple.finder NewWindowTargetPath -string "file://${HOME}/"
  #become_user: "{{ ansible_user }}"

- name: Enable spring-loading for folders
  shell: defaults write NSGlobalDomain com.apple.springing.enabled -bool true
  #become_user: "{{ ansible_user }}"

- name: Reduce delay for spring-loaded folders
  shell: defaults write NSGlobalDomain com.apple.springing.delay -float 0.1
  #become_user: "{{ ansible_user }}"

- name: Show status bar in Finder
  shell: defaults write com.apple.finder ShowStatusBar -bool true
  #become_user: "{{ ansible_user }}"

- name: Show path bar in Finder
  shell: defaults write com.apple.finder ShowPathbar -bool true
  #become_user: "{{ ansible_user }}"

- name: Set default Finder view to list view
  shell: defaults write com.apple.finder FXPreferredViewStyle -string "Nlsv"
  #become_user: "{{ ansible_user }}"

- name: Disable warning when changing file extensions
  shell: defaults write com.apple.finder FXEnableExtensionChangeWarning -bool false
  #become_user: "{{ ansible_user }}"

- name: Prevent .DS_Store files on USB drives
  shell: defaults write com.apple.desktopservices DSDontWriteUSBStores -bool true

- name: Show Library folder
  shell: chflags nohidden ~/Library

- name: Keep folders on top when sorting
  shell: defaults write com.apple.finder _FXSortFoldersFirst -bool true

- name: Search current folder by default
  shell: defaults write com.apple.finder FXDefaultSearchScope -string "SCcf"

- name: Expand save panel by default
  shell: defaults write NSGlobalDomain NSNavPanelExpandedStateForSaveMode -bool true

##########################
# Dock Tweaks
##########################
- name: Automatically hide the Dock
  shell: defaults write com.apple.dock autohide -bool true
  #become_user: "{{ ansible_user }}"

- name: Remove Dock auto-hide delay
  shell: defaults write com.apple.dock autohide-delay -float 0
  #become_user: "{{ ansible_user }}"

- name: Make Dock appear instantly
  shell: defaults write com.apple.dock autohide-time-modifier -float 0
  #become_user: "{{ ansible_user }}"

- name: Minimize windows into application icon
  shell: defaults write com.apple.dock minimize-to-application -bool true
  #become_user: "{{ ansible_user }}"

- name: Disable recent apps in Dock
  shell: defaults write com.apple.dock show-recents -bool false
  #become_user: "{{ ansible_user }}"

- name: Reset Dock to empty
  shell: |
    defaults write com.apple.dock persistent-apps -array
    defaults write com.apple.dock persistent-others -array

- name: Set Dock icon size
  shell: defaults write com.apple.dock tilesize -int 36

- name: Set Dock minimize animation to scale
  shell: defaults write com.apple.dock mineffect -string "scale"

##########################
# Keyboard & Input
##########################
- name: Set key repeat rate (fast)
  shell: defaults write NSGlobalDomain KeyRepeat -int 2

- name: Set initial key repeat delay (short)
  shell: defaults write NSGlobalDomain InitialKeyRepeat -int 15

- name: Disable text completion
  shell: defaults write NSGlobalDomain NSAutomaticTextCompletionEnabled -bool false

- name: Enable full keyboard access for all controls
  shell: defaults write NSGlobalDomain AppleKeyboardUIMode -int 3

- name: Disable press-and-hold for special characters (enable key repeat)
  shell: defaults write NSGlobalDomain ApplePressAndHoldEnabled -bool false

##########################
# System-wide Auto-Correct & Text Substitutions
##########################
- name: Disable auto spelling correction
  shell: defaults write NSGlobalDomain NSAutomaticSpellingCorrectionEnabled -bool false
  #become_user: "{{ ansible_user }}"

- name: Disable automatic capitalization
  shell: defaults write NSGlobalDomain NSAutomaticCapitalizationEnabled -bool false
  #become_user: "{{ ansible_user }}"

- name: Disable smart dashes
  shell: defaults write NSGlobalDomain NSAutomaticDashSubstitutionEnabled -bool false
  #become_user: "{{ ansible_user }}"

- name: Disable smart quotes
  shell: defaults write NSGlobalDomain NSAutomaticQuoteSubstitutionEnabled -bool false
  #become_user: "{{ ansible_user }}"

- name: Disable period substitution (double-space -> period)
  shell: defaults write NSGlobalDomain NSAutomaticPeriodSubstitutionEnabled -bool false
  #become_user: "{{ ansible_user }}"

##########################
# System Preferences
##########################
- name: Disable UI animations
  shell: defaults write NSGlobalDomain NSAutomaticWindowAnimationsEnabled -bool false

- name: Reduce transparency
  shell: defaults write com.apple.universalaccess reduceTransparency -bool true

- name: Disable sound effects
  shell: defaults write com.apple.systemsound "com.apple.sound.uiaudio.enabled" -int 0

- name: Create Screenshots directory
  file:
    path: "{{ ansible_env.HOME }}/Screenshots"
    state: directory
    mode: '0755'

- name: Set screenshots location
  shell: defaults write com.apple.screencapture location -string "{{ ansible_env.HOME }}/Screenshots"

- name: Set screenshots format to PNG
  shell: defaults write com.apple.screencapture type -string "png"

- name: Disable screenshot thumbnail preview
  shell: defaults write com.apple.screencapture show-thumbnail -bool false

- name: Enable three-finger drag (Accessibility)
  shell: defaults write com.apple.AppleMultitouchTrackpad TrackpadThreeFingerDrag -bool true

- name: Set scroll direction to not natural (Linux-like)
  shell: defaults write NSGlobalDomain com.apple.swipescrolldirection -bool false

##########################
# Security
##########################
- name: Require password immediately after sleep
  shell: defaults write com.apple.screensaver askForPasswordDelay -int 0

- name: Enable firewall
  shell: sudo /usr/libexec/ApplicationFirewall/socketfilterfw --setglobalstate on
  become: yes

- name: Enable stealth mode
  shell: sudo /usr/libexec/ApplicationFirewall/socketfilterfw --setstealthmode on
  become: yes

##########################
# Menu Bar
##########################
- name: Show battery percentage
  shell: defaults write com.apple.menuextra.battery ShowPercent -bool true

- name: Use 24-hour time format
  shell: defaults write NSGlobalDomain AppleICUForce24HourTime -bool true

##########################
# Other System Settings
##########################
- name: Expand print dialog by default
  shell: defaults write NSGlobalDomain PMPrintingExpandedStateForPrint -bool true

- name: Disable resume system-wide
  shell: defaults write com.apple.systempreferences NSQuitAlwaysKeepsWindows -bool false

- name: Disable disk image verification
  shell: defaults write com.apple.frameworks.diskimages skip-verify -bool true

- name: Disable Time Machine prompts for new disks
  shell: defaults write com.apple.TimeMachine DoNotOfferNewDisksForBackup -bool true

##########################
# Apply changes
##########################
- name: Restart Finder to apply changes
  shell: killall Finder || true
  #become_user: "{{ ansible_user }}"

- name: Restart Dock to apply changes
  shell: killall Dock || true
  #become_user: "{{ ansible_user }}"
